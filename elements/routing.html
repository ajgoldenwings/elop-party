<script src="../bower_components/page/page.js"></script>
<script>
	window.addEventListener('WebComponentsReady', function() {

		// We use Page.js for routing. This is a Micro
		// client-side router inspired by the Express router
		// More info: https://visionmedia.github.io/page.js/

		// Middleware
		function scrollToTop(ctx, next) {
			app.scrollPageToTop();
			app.resetCurrentPositionReset();
			app.resetEventAdd();
			app.resetEventLoad();

			var visiblePaperDialog = jQuery('paper-dialog:visible');
			if(visiblePaperDialog.length > 0)
				window[visiblePaperDialog.attr('id')].close();

			next();
		}

		// Routes
		page('/', scrollToTop, function() {
			if (app.isNotLoggedIn) {
				app.helper_user.BaasBox_fetchCurrentUser();
			} else {
				if (!app.elop_events_loaded) {
					app.helper_event.events_load();
				}
				app.route = 'events';
			}
		});

		page('/about', scrollToTop, function() {
			app.route = 'about';
		});

		page('/baasbox', scrollToTop, function() {
			app.route = 'baasbox';
		});

		page('/change_Password_Action', scrollToTop, function() {
			app.helper_user.change_password();
			app.route = 'settings';

		});

		page('/contact', scrollToTop, function() {
			app.route = 'contact';
		});

		page('/event/:eventid', scrollToTop, function(data) {
			app.route = 'event';
			app.params = data.params;
			app.helper_event.event_load();
		});

		page('/event_add', scrollToTop, function() {
			app.route = 'event_add';
			app.event_length = 0;
			document.getElementById("event-length").innerHTML = '';
			app.getCurrentPositionForEvent();
		});

		page('/events', scrollToTop, function() {
			if (!app.elop_events_loaded) {
				app.helper_event.events_load();
			}
			app.route = 'events';
		});

		page('/logout', scrollToTop, function() {
			app.route = 'logingout';
			app.helper_user.logout();
			app.route = 'signon';
		});

		page('/map', scrollToTop, function() {
			app.route = 'map';
		});

		page('/more', scrollToTop, function() {
			app.route = 'more';
		});

		page('/settings', scrollToTop, function() {
			app.route = 'settings';
		});

		page('/signon', scrollToTop, function() {
			app.route = 'signon';
		});

		page('/signon_Action', scrollToTop, function() {
			app.route = 'loading';
			app.helper_user.login();
		});

		page('/welcome', scrollToTop, function() {
			app.welcomeShow();
		});

		page('/signup', scrollToTop, function() {
			app.route = 'signup';
		});

		page('/signup_Action', scrollToTop, function() {
			app.route = 'loading';
			app.helper_user.signup();
		});

		page('/users', scrollToTop, function() {
			app.route = 'users';
		});

		page('/users/:name', scrollToTop, function(data) {
			app.route = 'user-info';
			app.params = data.params;
		});

		// add #! before urls
		page({
			hashbang: true
		});

	});
</script>
